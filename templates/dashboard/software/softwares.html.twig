{% extends 'Admin.base.html.twig' %}

{% block title %}Logiciels clients{% endblock %}

{% block body %}

    <div class="ui content">
        <h2 class="ui header">
            Liste des logiciels clients
        </h2>

        {% for msg in app.flashes('error') %}
            {{ component('Alert', {type: 'error', text: msg}) }}
            <br>
        {% endfor %}

        {% for msg in app.flashes('success') %}
            {{ component('Alert', {type: 'success', text: msg}) }}
            <br>
        {% endfor %}

        <a href="{{ path('app_dashboard_software_new') }}">
            <button class="ui icon labeled green button">
                <i class="plus icon"></i>
                Nouveau
            </button>
        </a>
        {% if is_granted('ROLE_ADMIN') %}
            <button class="ui icon labeled teal button" onclick="searchId()">
                <i class="search icon"></i>
                ID
                <script>
					let searchId = () => {
						let id = prompt("Saisir l'ID")
						if(id) {
							let url = "{{ path('app_dashboard_software_edit', { 'id': 'ID_REPLACE' }) }}"
							url = url.replace('ID_REPLACE', id)
							window.location.href = url
						}
					}
                </script>
            </button>
        {% endif %}
        <br><br>
        <table class="ui celled table">
            <thead>
            <tr>
                <th>Nom du logiciel</th>
                <th>Client</th>
                <th>Identifiant</th>
                <th>Mot de passe</th>
                <th class="th_action"><i class="delete icon"></i></th>
            </tr>
            </thead>
            <tbody>
            {% for software in softwares %}
                <tr>
                    <td><a href="{{ path('app_dashboard_software_edit', {id: software.id}) }}">{{ software.type.name }}</a></td>
                    <td>{{ software.customer.name }}</td>
                    <td>{{ software.username ?? '' }}</td>
                    <td>{{ software.password }}</td>
                    <td><a class="ui red label" href="{{ path('app_dashboard_software_delete', {id: software.id}) }}">Supprimer</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>


        <br><br><h2 class="ui header">
            Moteur de déploiement (Webdev)
        </h2>
        <a href="{{ path('app_dashboard_software_webdev_add') }}">
            <button class="ui icon labeled green button">
                <i class="plus icon"></i>
                Nouveau
            </button>
        </a>

        <br><br>
        <table class="ui celled table">
            <thead>
            <tr>
                <th>Client</th>
                <th>Numéro de série</th>
                <th>Clé d'activation</th>
                <th>Date d'échéance</th>
                <th class="th_action"><i class="delete icon"></i></th>
            </tr>
            </thead>
            <tbody>
            {% for webdev in webdevs %}
                <tr>
                    <td><a href="{{ path('app_dashboard_software_webdev_update', {id: webdev.id}) }}">{{ webdev.customer.name }}</a></td>
                    <td>{{ webdev.serialNumber }}</td>
                    <td>{{ webdev.activationKey }}</td>
                    <td>{{ webdev.echeanceDate|date("d F Y") }}</td>
                    <td><a class="ui red label" href="{{ path('app_dashboard_software_webdev_delete', {id: webdev.id}) }}">Supprimer</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    </div>

{% endblock %}
